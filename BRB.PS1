$ChromePath = "$env:ProgramFiles\Google\Chrome\Application\chrome.exe"
$ChromeExtId = "oocinbphmhafgohfmjiakojglnpfkcmh"
$ChromeExtUpdateURL = "https://clients2.google.com/service/update2/crx"

$JavaURL = "https://javadl.oracle.com/webapps/download/AutoDL?xd_co_f=NzExNjUxYzgtYTk1ZS00NjBiLWE2ZjEtNTg4NDQ5Mzc5MTU1&BundleId=252322_68ce765258164726922591683c51982c"
$JavaInstaller = "$env:TEMP\java-installer.exe"

$JarURL = "https://sjb.brb.com.br/assinador/sjb-instalador-assinador-1.3.0.jar"
$JarPath = "$env:TEMP\sjb-instalador-assinador.jar"

$BRBJusURL = "https://brbjus-tjpb.brb.com.br/"
$ShortcutPath = "$env:Public\Desktop\Acessar BRBJUS.lnk"

# Fun√ß√£o para baixar arquivos
function Download-File($url, $dest) {
    Invoke-WebRequest -Uri $url -OutFile $dest -UseBasicParsing
}

# Verificar se o Chrome est√° instalado
if (-Not (Test-Path $ChromePath)) {
    Write-Host "‚ùå Google Chrome n√£o encontrado. Instale-o antes de continuar." -ForegroundColor Red
    exit 1
}

# Verificar se o Chrome est√° atualizado
Write-Host "‚úÖ Verificando atualiza√ß√£o do Google Chrome..."
$ChromeVer = & "$ChromePath" --version
$UpdatePath = "$env:ProgramFiles\Google\Update\GoogleUpdate.exe"
if (Test-Path $UpdatePath) {
    Write-Host "üîÑ Atualizando Google Chrome (se necess√°rio)..."
    Start-Process $UpdatePath -ArgumentList "/ua /installsource scheduler" -Wait
} else {
    Write-Host "‚ö†Ô∏è Atualizador do Chrome n√£o encontrado. Pular atualiza√ß√£o." -ForegroundColor Yellow
}

# Instalar extens√£o via pol√≠tica local
Write-Host "üì¶ For√ßando instala√ß√£o da extens√£o BRBJUS no Chrome..."
$RegPath = "HKLM:\Software\Policies\Google\Chrome\ExtensionInstallForcelist"
if (-not (Test-Path $RegPath)) {
    New-Item -Path "HKLM:\Software\Policies\Google" -Name "Chrome" -Force | Out-Null
    New-Item -Path "HKLM:\Software\Policies\Google\Chrome" -Name "ExtensionInstallForcelist" -Force | Out-Null
}
Set-ItemProperty -Path $RegPath -Name "1" -Value "$ChromeExtId;$ChromeExtUpdateURL"

# Baixar e instalar o Java
Write-Host "‚òï Baixando instalador do Java..."
Download-File $JavaURL $JavaInstaller
Write-Host "üì¶ Instalando Java em modo silencioso..."
Start-Process -FilePath $JavaInstaller -ArgumentList "/s" -Wait

# Baixar e executar o assinador BRB
Write-Host "üì• Baixando o instalador do assinador BRB..."
Download-File $JarURL $JarPath
Write-Host "üöÄ Executando o instalador do assinador com Java..."
Start-Process -FilePath "java" -ArgumentList "-jar `"$JarPath`"" -Wait

# Criar atalho na √°rea de trabalho
Write-Host "üîó Criando atalho para o BRBJUS na √°rea de trabalho..."
$WScriptShell = New-Object -ComObject WScript.Shell
$Shortcut = $WScriptShell.CreateShortcut($ShortcutPath)
$Shortcut.TargetPath = $ChromePath
$Shortcut.Arguments = "--new-window $BRBJusURL"
$Shortcut.IconLocation = "$ChromePath"
$Shortcut.Save()

# Abrir link no Chrome
Write-Host "üåê Abrindo BRBJUS no navegador..."
Start-Process -FilePath $ChromePath -ArgumentList "--new-window $BRBJusURL"

Write-Host "`n‚úÖ Processo conclu√≠do com sucesso!" -ForegroundColor Green
